pipeline:
  ssh:
    image: appleboy/drone-ssh
    host: ec2-54-169-3-169.ap-southeast-1.compute.amazonaws.com
    username: ubuntu
    key_path: ./deploy/key.pem
    port: 22
    script:
      - cd /var/www/html/web-server/
      - git pull origin master
    when:
      status: success

  slack:
    image: plugins/slack
    webhook: https://hooks.slack.com/services/${SLACK_SERVICE}
    channel: devchannel
    username: incoming-webhook
    icon_url: https://unsplash.it/256/256/?random
    when:
      event: [ push ]

  clone:
    image: plugins/git
    recursive: true
    submodule_override:
      laravel54: https://github.com/minhhai8x/laravel54.git

  backend:
    image: laradock/workspace:1.8-71
    group: laravel
    commands:
      - php -v
      - composer -V
      - cp .env.example .env
      - composer install --prefer-dist
      - php artisan key:generate
      - php artisan migrate
      - ./vendor/bin/phpunit
